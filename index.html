<!DOCTYPE html>
<!-- Author: Matthew Richardson -->
<html>

<head>
	<title>Number Space</title>
	<script src="ns_polygons.js"></script>
	<script src="ns_functions.js"></script>
	<script>

		function onLoad() {

			const canvas = document.getElementById("ns_canvas");
			const context = canvas.getContext("2d");

			canvas.width = innerWidth;
			canvas.height = innerHeight;

			const mouse = { x: 0, y: 0 };

			canvas.onmousemove = function (event) {
				mouse.x = event.clientX;
				mouse.y = event.clientY;
			};

			canvas.onclick = function (event) {
				debugMode = !debugMode;
				onTile = false;
				tileX = 0;
				tileY = 0;
			};

			// const tileY1 = createTile("white", dieFace("lightcoral"), pipCC);
			// const tileY2 = createTile("white", dieFace("lightsteelblue"), pipTR, pipBL);
			// const tileY3 = createTile("white", dieFace("yellow"), pipTR, pipCC, pipBL);
			// const tileY4 = createTile("white", dieFace("plum"), pipTL, pipTR, pipBL, pipBR);
			// const tileY5 = createTile("white", dieFace("lightgreen"), pipTL, pipTR, pipCC, pipBL, pipBR);
			// const tileY6 = createTile("white", dieFace("pink"), pipTL, pipTR, pipCL, pipCR, pipBL, pipBR);
			// tileY3.linkTo(tileY6, getOri(0), getDir(2));
			// tileY6.linkTo(tileY5, getOri(0), getDir(0));
			// tileY5.linkTo(tileY1, getOri(0), getDir(0));
			// tileY1.linkTo(tileY2, getOri(0), getDir(0));
			// tileY2.linkTo(tileY6, getOri(0), getDir(0));
			// tileY6.linkTo(tileY4, getOri(0), getDir(2));
			// tileY3.linkTo(tileY5, getOri(6), getDir(0));
			// tileY3.linkTo(tileY1, getOri(3), getDir(3));
			// tileY3.linkTo(tileY2, getOri(5), getDir(1));
			// tileY4.linkTo(tileY5, getOri(5), getDir(0));
			// tileY4.linkTo(tileY1, getOri(3), getDir(2));
			// tileY4.linkTo(tileY2, getOri(6), getDir(1));
			// const tileT0 = createTile("white", dieFace("lightcoral"));
			// const tileT1 = createTile("white", dieFace("lightsteelblue"));
			// const tileT2 = createTile("white", dieFace("yellow"));
			// const tileT3 = createTile("white", dieFace("plum"));
			// const tileT4 = createTile("white", dieFace("lightgreen"));
			// const tileT5 = createTile("white", dieFace("pink"));
			// const tileT6 = createTile("white", dieFace("yellow"), pipCC);
			// const tileT7 = createTile("white", dieFace("plum"), pipCC);
			// const tileT8 = createTile("white", dieFace("lightgreen"), pipCC);
			// const tileT9 = createTile("white", dieFace("pink"), pipCC);
			// tileT0.linkTo(tileT1, getOri(0), getDir(2));
			// tileT1.linkTo(tileT2, getOri(0), getDir(2));
			// tileT1.linkTo(tileT3, getOri(6), getDir(0));
			// tileT2.linkTo(tileT3, getOri(0), getDir(0));
			// tileT3.linkTo(tileT4, getOri(0), getDir(0));
			// tileT3.linkTo(tileT7, getOri(0), getDir(2));
			// tileT4.linkTo(tileT5, getOri(5), getDir(2));
			// tileT5.linkTo(tileT6, getOri(0), getDir(3));
			// tileT5.linkTo(tileT8, getOri(0), getDir(2));
			// tileT5.linkTo(tileT9, getOri(6), getDir(0));
			// tileT7.linkTo(tileT8, getOri(0), getDir(0));
			// tileT8.linkTo(tileT9, getOri(0), getDir(0));
			// const tileL0 = createTile("white", dieFace("lightcoral"));
			// const tileL1 = createTile("white", dieFace("lightsteelblue"));
			// const tileL2 = createTile("white", dieFace("yellow"));
			// tileL0.linkTo(tileL1, getOri(0), getDir(0));
			// tileL0.linkTo(tileL1, getOri(0), getDir(2));
			// tileL1.linkTo(tileL2, getOri(0), getDir(0));
			// tileL1.linkTo(tileL2, getOri(0), getDir(2));
			const tileT1 = createTile("white", dieFace("lightsteelblue"));
			const tileT2 = createTile("white", dieFace("yellow"));
			const tileT3 = createTile("white", dieFace("plum"));
			const tileT4 = createTile("white", dieFace("lightgreen"));
			const tileT5 = createTile("white", dieFace("pink"));
			const tileT6 = createTile("white", dieFace("lightcoral"));
			const tileT7 = createTile("white", dieFace("yellow"), pipCC);
			const tileT8 = createTile("white", dieFace("plum"), pipCC);
			const tileT9 = createTile("white", dieFace("lightgreen"), pipCC);
			tileT1.linkTo(tileT2, getOri(5), getDir(1));
			tileT1.linkTo(tileT3, getOri(0), getDir(2));
			tileT1.linkTo(tileT4, getOri(6), getDir(0));
			tileT2.linkTo(tileT3, getOri(0), getDir(0));
			tileT3.linkTo(tileT4, getOri(0), getDir(0));
			tileT3.linkTo(tileT8, getOri(0), getDir(2));
			tileT5.linkTo(tileT6, getOri(5), getDir(1));
			tileT5.linkTo(tileT7, getOri(0), getDir(2));
			tileT6.linkTo(tileT7, getOri(0), getDir(0));
			tileT6.linkTo(tileT9, getOri(5), getDir(2));
			tileT7.linkTo(tileT8, getOri(0), getDir(0));
			tileT7.linkTo(tileT9, getOri(0), getDir(2));
			

			// game starts with single tile visible in the center of the the screen
			// once the mouse is within that tile, draw the tile tree (reveal the tree edges with expanding circle)
			// function to detect when mouse leaves current square
			// should mouse have max speed? could it skip around when moving too quickly?

			const len = 100;
			const midX = (canvas.width - len) / 2;
			const midY = (canvas.height - len) / 2;
			let tileX = 0;
			let tileY = 0;
			const xLim = Math.ceil(midX / len);
			const yLim = Math.ceil(midY / len);
			const walk = startWalk(tileT1, getOri(0));
			let onTile = false;
			const xAxis = { a: { x: 0, y: 0 }, b: { x: 1, y: 0 } };
			const yAxis = { a: { x: 0, y: 0 }, b: { x: 0, y: 1 } };

			function drawScene() {
				const dx = Math.floor((mouse.x - midX) / len) - tileX;
				const dy = Math.floor((mouse.y - midY) / len) - tileY;
				if (onTile) {
					if (dx != 0) {
						if (walk.attempt(getDir(dx > 0 ? 0 : 1))) {
							tileX += dx;
						} else {
							onTile = false;
						}
					} else if (dy != 0) {
						if (walk.attempt(getDir(dy > 0 ? 2 : 3))) {
							tileY += dy;
						} else {
							onTile = false;
						}
					}
				} else if (dx == 0 && dy == 0) {
					onTile = true;
				}
				const pTL = { x: midX + tileX * len, y: midY + tileY * len };
				let limits = [xLim - tileX, xLim + tileX, yLim - tileY, yLim + tileY];
				if (limits.some(lim => lim < 0)) {
					limits = [1, 1, 1, 1];
				}
				if (onTile) {
					// let limits = [xLim - tileX, xLim + tileX, yLim - tileY, yLim + tileY];
					// if (limits.some(lim => lim < 0)) {
					// 	limits = [1, 1, 1, 1];
					// }
					tileTree(walk, pTL, mouse, len, limits, context);
				} else {
					tileTree(walk, pTL, { x: pTL.x + len / 2, y: pTL.y + len / 2}, len, limits, context);
					// const updater = getUpdater(pTL, len, walk.currOri());
					// walk.currTile().draw(updater, yAxis, xAxis, context);
				}
			}

			const times = [];
			let fps;

			function drawInfo() {
				const str = "(" + tileX + ", " + tileY + ") fps: " + fps;
				context.fillText(str, canvas.width - 100, 20);
			}

			(function animate() {
				context.clearRect(0, 0, canvas.width, canvas.height);
				drawScene();
				if (debugMode) {
					const now = performance.now();
					while (times.length > 0 && times[0] <= now - 1000) {
						times.shift();
					}
					times.push(now);
					fps = times.length;
					drawInfo();
				}
				requestAnimationFrame(animate);
			})();

		}

	</script>
</head>

<body onload="onLoad()">
	<canvas id="ns_canvas"></canvas>
	<style>
		* {
			margin: 0;
			padding: 0;
		}
	</style>
</body>

</html>