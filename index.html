<!DOCTYPE html>
<!-- Author: Matthew Richardson -->
<html>
<head>
	<title>Number Space</title>
	<script src="ns_polygons.js"></script>
	<script src="ns_functions.js"></script>
	<script>

		function onLoad() {

			const canvas = document.getElementById("ns_canvas");
			const context = canvas.getContext("2d");

			canvas.width = innerWidth;
			canvas.height = innerHeight;

			let mouseX = canvas.width / 2 + 50;
			let mouseY = canvas.height / 2 + 50;
			let prevX = mouseX;
			let prevY = mouseY;

			canvas.onmousemove = function(event) {
				mouseX = event.clientX;
				mouseY = event.clientY;
			};

			canvas.onmousedown = function(event) {
				debugMode = !debugMode;
			};

			let tileG1 = createTile("green", { fillStyle: "black", verts: digit1 });
			let tileR2 = createTile("red", { fillStyle: "black", verts: digit4 });
			let tileL3 = createTile("lightsteelblue", { fillStyle: "black", verts: digit7 });
			let tileB4 = createTile("blue", { fillStyle: "black", verts: digit1 });
			let tileY5 = createTile("yellow", { fillStyle: "black", verts: digit4 });
			let tileP6 = createTile("purple", { fillStyle: "black", verts: digit7 });
			// let tileV = createTile("violet", { fillStyle: "black", verts: digit1 });
			// let tileM = createTile("magenta", { fillStyle: "black", verts: digit4 });
			// let tileT = createTile("turquoise", { fillStyle: "black", verts: digit7 });
			tileG1.linkTo(tileR2, getOri(0), getDir(3), true);
			tileG1.linkTo(tileY5, getOri(0), getDir(2), true);
			tileG1.linkTo(tileL3, getOri(5), getDir(0), true);
			tileG1.linkTo(tileB4, getOri(5), getDir(1), true);
			tileP6.linkTo(tileL3, getOri(3), getDir(3), true);
			tileP6.linkTo(tileB4, getOri(3), getDir(2), true);
			tileP6.linkTo(tileR2, getOri(6), getDir(0), true);
			tileP6.linkTo(tileY5, getOri(6), getDir(1), true);
			tileY5.linkTo(tileL3, getOri(3), getDir(0), false);
			tileL3.linkTo(tileY5, getOri(3), getDir(0), false);
			tileY5.linkTo(tileB4, getOri(0), getDir(1), false);
			tileB4.linkTo(tileY5, getOri(0), getDir(0), false);
			tileR2.linkTo(tileL3, getOri(0), getDir(0), true);
			tileR2.linkTo(tileB4, getOri(3), getDir(1), false);
			tileB4.linkTo(tileR2, getOri(3), getDir(1), false);
			// tileR.isEmpty = () => true;

			// game starts with single tile visible in the center of the the screen
			// once the mouse is within that tile, draw the tile tree (reveal the tree edges with expanding circle)
			// function to detect when mouse leaves current square
			// should mouse have max speed? could it skip around when moving too quickly?

			function drawScene() {
				tileTree(tileR2, { x: canvas.width / 2, y: canvas.height / 2 }, { x: mouseX, y: mouseY }, 100, { x: 3, y: 1 }, context);
				// tileTree(tileR2, { x: 0, y: 0 }, { x: 1, y: 1 }, 2, { x: 1, y: 1 }, context);
			}

			const times = [];
			let fps;

			function drawInfo() {
				let str = "(" + mouseX +  ", " + mouseY + ") fps: " + fps;
				context.fillText(str, canvas.width - 100, 20);
			}

			(function animate() {
				context.clearRect(0, 0, canvas.width, canvas.height);
				drawScene();
				if (debugMode) {
					const now = performance.now();
					while (times.length > 0 && times[0] <= now - 1000) {
						times.shift();
					}
					times.push(now);
					fps = times.length;
					drawInfo();
				}
				requestAnimationFrame(animate);
			})();

		}

	</script>
</head>
<body onload="onLoad()">
	<canvas id="ns_canvas"></canvas>
	<style>
		* {
			margin: 0;
			padding: 0;
		}
	</style>
</body> 
</html>
